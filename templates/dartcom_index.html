{% extends 'base.html' %}

{% block title %}Transferências{% endblock %}

{% block content %}
{% if msg %}
<h4>Mensagem: {{ msg }}</h4>
{% endif %}
<div class="info-container">    
    <div class="info-transfer-list">
        <div class="dados">
            <div class="text">Fila</div>
            {% if not transfer_list %}
            Não há dados na fila
            {% endif %}
            {% for file in transfer_list %}
            <span>{{ file }}</span><br>
            {% endfor %}
        </div>
    </div>
    <div class="info-transfer-volume">
        <div class="dados">
            <div class="text">Volume diário</div>
            {{ '-' if daily_volume == None else daily_volume|size_to_human_view }}
        </div>
    </div>
</div>

<div class="dados-container">
    <div class="dados-list">
        <div class="dados" id="list-data">
            <div class="header-container">
                <div class="text">Transferências</div>
                <form id="items-form" action="{{ url_for('dartcom') }}" method="get" style="display: inline;">
                    <label for="items-per-page">Itens:</label>
                    <select name="items" id="items_per_page" onchange="this.form.submit()">
                        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                        <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                        <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                        <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                    </select>
                </form>
            </div>
            <form action="{{ url_for('dartcom')}}" method="post" autocomplete="off"> 
                <div class="dados" id="search">
                    <div class="search-container">
                        <button type="button" id="clear-search" class="clear-button">&times;</button>
                        <input type="text" id="search-data" name="search-data" placeholder="  Pesquisa" class="form-control search-data" aria-describedby="basic-addon1">
                        <button type="submit" id="search-submit" class="button button-small"> Buscar</button>
                    </div>
                </div>
            </form>
            <div class="table">
                <div class="row header">
                    <div class="cell name">Nome</div>
                    <div class="cell fixed">Compactar</div>
                    <div class="cell fixed">Data</div>                    
                    <div class="cell fixed">Armazenamento</div>
                    <div class="cell fixed">Data</div>
                    <div class="cell fixed">Tempo</div>
                </div>
            
                {% for dartcom in dartcoms %}
                <div class="row click dado-row" id="{{ dado.id }}">
                    <div class="cell name">{{ dartcom.nome }}</div>
                    <div class="cell fixed">
                        <div class="status {{ dartcom.compressed_status|class_status }}">
                            {{ dartcom.compressed_status if dartcom.compressed_status else 'Aguardando' }}
                        </div>
                    </div>
                    <div class="cell fixed">{{ '-' if not dartcom.compressed_end_datetime else dartcom.compressed_end_datetime.strftime("%d/%m/%Y") }}</div>
                    <div class="cell fixed">
                        <div class="status {{ dartcom.storing_status|class_status }}">
                            {{ dartcom.storing_status if dartcom.storing_status else 'Aguardando' }}
                        </div>
                    </div>
                    <div class="cell fixed">{{ '-' if not dartcom.storing_end_datetime else dartcom.storing_end_datetime.strftime("%d/%m/%Y") }}</div>
                    <div class="cell fixed">{{ '-' if not dartcom.storing_time else dartcom.storing_time }}</div>
                </div>
                {% endfor %}

		<div class="pagination">
                    {% if page > 1 %}
                        <a href="{{ url_for('dartcom', pag=page-1, search=search_data, items=per_page) }}">Anterior</a>
                    {% endif %}

                    Página {{ page }} de {{ total_pages.total_pages if total_pages else 1 }}

                    {% if page < total_pages.total_pages %}
                        <a href="{{ url_for('dartcom', pag=page+1, search=search_data, items=per_page) }}">Próxima</a>
                    {% endif %}
                </div>
                <div>
                    Total: {{ total_pages.total_items }}
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<br>
{% endblock %}

{% block scripts%}
<script>
    // open data on click
    var rows = document.querySelectorAll('.click');
    rows.forEach(function(div) {
        div.addEventListener('click', function() {
            var id = this.id;
            window.location.href = 'dartcom/' + id;
        });
    });

    // reload page
    reloadPage();
</script>
{% endblock %}
